<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.earlybud.model.Member">
  	<resultMap type="Member" id="memberMap"><!-- dto mapping -->
  		<result property="email" column="EMAIL"/>
  		<result property="pwd" column="PWD"/>
  		<result property="nickname" column="NICKNAME"/>
  		<result property="phone" column="PHONE"/>
  		<result property="addr" column="ADDR"/>
  		<result property="detail_addr" column="DETAIL_ADDR"/>
  		<result property="joindate" column="JOINDATE"/>
  		<result property="dropdate" column="DROPDATE"/>
  		<result property="item_liked" column="ITEM_LIKED"/>
  		<collection property="authList" resultMap="authMap"></collection>
  	</resultMap>
  	
  	<resultMap type="Authorities" id="authMap">
    	<result property="email" column="EMAIL"/>
    	<result property="authority" column="AUTHORITY"/>
 	</resultMap>
  	
  	<select id="read" resultMap="memberMap">
  	SELECT 
  	mem.email, pwd, nickname, phone, addr, detail_addr, joindate, dropdate, item_liked, authority 
  	FROM 
  	member mem LEFT OUTER JOIN authorities auth on mem.email = auth.email 
  	WHERE mem.email = #{email} 
  	</select>
  	
  	<select id="listMember" resultMap="memberMap">
  	SELECT 
  	mem.email, nickname, phone, addr, detail_addr, joindate, dropdate, item_liked, authority 
  	FROM 
  	member mem LEFT OUTER JOIN authorities auth on mem.email = auth.email 
  	where mem.dropdate is null
  	</select>
  	
  	<update id="dropMember" parameterType="String">
  	update member set dropdate=sysdate where email = #{email}
  	</update>
  	
  </mapper>